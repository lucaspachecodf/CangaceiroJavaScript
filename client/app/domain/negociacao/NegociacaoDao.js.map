{"version":3,"sources":["../../../app-src/domain/negociacao/NegociacaoDao.js"],"names":["Negociacao","NegociacaoDao","constructor","connection","_connection","_store","adiciona","negociacao","Promise","resolve","reject","request","transaction","objectStore","add","onsuccess","e","onerror","console","log","target","error","listaTodos","negociacoes","cursor","openCursor","atual","result","value","_data","_quantidade","_valor","push","continue","apagaTodos","clear","apaga","DaoFactory","getNegociacaoDao","then","dao","_negociacoes","esvazia","_mensagem","texto","catch","err"],"mappings":";;;;;;AAASA,sB,iBAAAA,U;;;gBAEIC,a,GAAN,MAAMA,aAAN,CAAoB;AACvBC,4BAAYC,UAAZ,EAAwB;AACpB,yBAAKC,WAAL,GAAmBD,UAAnB;AACA,yBAAKE,MAAL,GAAc,aAAd;AACH;AACDC,yBAASC,UAAT,EAAqB;AACjB,2BAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpC,8BAAMC,UAAU,KAAKP,WAAL,CACXQ,WADW,CACC,CAAC,KAAKP,MAAN,CADD,EACgB,WADhB,EAEXQ,WAFW,CAEC,KAAKR,MAFN,EAGXS,GAHW,CAGPP,UAHO,CAAhB;AAIAI,gCAAQI,SAAR,GAAoBC,KAAKP,SAAzB;AACAE,gCAAQM,OAAR,GAAkBD,KAAK;AACnBE,oCAAQC,GAAR,CAAYH,EAAEI,MAAF,CAASC,KAArB;AACAX,mCAAO,sCAAP;AACH,yBAHD;AAIH,qBAVM,CAAP;AAWH;AACDY,6BAAa;AACT,2BAAO,IAAId,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpC,8BAAMa,cAAc,EAApB;AACA,8BAAMC,SAAS,KAAKpB,WAAL,CACVQ,WADU,CACE,CAAC,KAAKP,MAAN,CADF,EACiB,WADjB,EAEVQ,WAFU,CAEE,KAAKR,MAFP,EAGVoB,UAHU,EAAf;AAIAD,+BAAOT,SAAP,GAAmBC,KAAK;AACpB,kCAAMU,QAAQV,EAAEI,MAAF,CAASO,MAAvB;AACA,gCAAID,KAAJ,EAAW;AACP,sCAAMnB,aAAa,IAAIP,UAAJ,CACf0B,MAAME,KAAN,CAAYC,KADG,EAEfH,MAAME,KAAN,CAAYE,WAFG,EAGfJ,MAAME,KAAN,CAAYG,MAHG,CAAnB;AAIAR,4CAAYS,IAAZ,CAAiBzB,UAAjB;AACAmB,sCAAMO,QAAN;AACH,6BAPD,MAOO;AACHxB,wCAAQc,WAAR;AACH;AACJ,yBAZD;AAaAC,+BAAOP,OAAP,GAAiBD,KAAK;AAClBE,oCAAQC,GAAR,CAAYH,EAAEI,MAAF,CAASC,KAArB;AACAX,mCAAO,yCAAP;AACH,yBAHD;AAIH,qBAvBM,CAAP;AAwBH;;AAEDwB,6BAAa;AACT,2BAAO,IAAI1B,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpC,8BAAMC,UAAU,KAAKP,WAAL,CACXQ,WADW,CACC,CAAC,KAAKP,MAAN,CADD,EACgB,WADhB,EAEXQ,WAFW,CAEC,KAAKR,MAFN,EAGX8B,KAHW,EAAhB;AAIAxB,gCAAQI,SAAR,GAAoBC,KAAKP,SAAzB;AACAE,gCAAQM,OAAR,GAAkBD,KAAK;AACnBE,oCAAQC,GAAR,CAAYH,EAAEI,MAAF,CAASC,KAArB;AACAX,mCAAO,wCAAP;AACH,yBAHD;AAIH,qBAVM,CAAP;AAWH;;AAED0B,wBAAQ;AACJC,+BACKC,gBADL,GAEKC,IAFL,CAEUC,OAAOA,IAAIN,UAAJ,EAFjB,EAGKK,IAHL,CAGU,MAAM;AACR,6BAAKE,YAAL,CAAkBC,OAAlB;AACA,6BAAKC,SAAL,CAAeC,KAAf,GAAuB,kCAAvB;AACH,qBANL,EAOKC,KAPL,CAOWC,OAAO,KAAKH,SAAL,CAAeC,KAAf,GAAuBE,GAPzC;AAQH;AApEsB,a","file":"NegociacaoDao.js","sourcesContent":["import { Negociacao } from './Negociacao.js';\r\n\r\nexport class NegociacaoDao {\r\n    constructor(connection) {\r\n        this._connection = connection;\r\n        this._store = 'negociacoes';\r\n    }\r\n    adiciona(negociacao) {\r\n        return new Promise((resolve, reject) => {\r\n            const request = this._connection\r\n                .transaction([this._store], 'readwrite')\r\n                .objectStore(this._store)\r\n                .add(negociacao);\r\n            request.onsuccess = e => resolve();\r\n            request.onerror = e => {\r\n                console.log(e.target.error);\r\n                reject('Não foi possível salvar a negociação');\r\n            }\r\n        });\r\n    }\r\n    listaTodos() {\r\n        return new Promise((resolve, reject) => {\r\n            const negociacoes = [];\r\n            const cursor = this._connection\r\n                .transaction([this._store], 'readwrite')\r\n                .objectStore(this._store)\r\n                .openCursor();\r\n            cursor.onsuccess = e => {\r\n                const atual = e.target.result;\r\n                if (atual) {\r\n                    const negociacao = new Negociacao(\r\n                        atual.value._data,\r\n                        atual.value._quantidade,\r\n                        atual.value._valor);\r\n                    negociacoes.push(negociacao);\r\n                    atual.continue();\r\n                } else {\r\n                    resolve(negociacoes);\r\n                }\r\n            }\r\n            cursor.onerror = e => {\r\n                console.log(e.target.error);\r\n                reject('Não\tfoi\tpossível\tlistar\tnas\tnegociações');\r\n            }\r\n        });\r\n    }\r\n\r\n    apagaTodos() {\r\n        return new Promise((resolve, reject) => {\r\n            const request = this._connection\r\n                .transaction([this._store], 'readwrite')\r\n                .objectStore(this._store)\r\n                .clear();\r\n            request.onsuccess = e => resolve();\r\n            request.onerror = e => {\r\n                console.log(e.target.error);\r\n                reject('Não foi possível apagar as negociações');\r\n            };\r\n        });\r\n    }\r\n\r\n    apaga() {\r\n        DaoFactory\r\n            .getNegociacaoDao()\r\n            .then(dao => dao.apagaTodos())\r\n            .then(() => {\r\n                this._negociacoes.esvazia();\r\n                this._mensagem.texto = 'Negociações apagadas com sucesso';\r\n            })\r\n            .catch(err => this._mensagem.texto = err);\r\n    }\r\n}"]}